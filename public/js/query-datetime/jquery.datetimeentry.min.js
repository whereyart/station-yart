/* http://keith-wood.name/datetimeEntry.html
   Date and time entry for jQuery v1.1.1.
   Written by Keith Wood (kbwood{at}iinet.com.au) September 2010.
   Licensed under the MIT (https://github.com/jquery/jquery/blob/master/MIT-LICENSE.txt) license.
   Please attribute the author if you use it. */
(function($){function DatetimeEntry(){this._disabledInputs=[];this.regional=[];this.regional['']={datetimeFormat:'O/D/Y H:Ma',datetimeSeparators:'.',monthNames:['January','February','March','April','May','June','July','August','September','October','November','December'],monthNamesShort:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],dayNames:['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'],dayNamesShort:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],ampmNames:['AM','PM'],spinnerTexts:['Today','Previous field','Next field','Increment','Decrement'],isRTL:false};this._defaults={appendText:'',initialField:0,useMouseWheel:true,shortYearCutoff:'+10',defaultDatetime:null,minDatetime:null,maxDatetime:null,minTime:null,maxTime:null,timeSteps:[1,1,1],spinnerImage:'spinnerDefault.png',spinnerSize:[20,20,8],spinnerBigImage:'',spinnerBigSize:[40,40,16],spinnerIncDecOnly:false,spinnerRepeat:[500,250],beforeShow:null,altField:null,altFormat:null};$.extend(this._defaults,this.regional[''])}$.extend(DatetimeEntry.prototype,{markerClassName:'hasDatetimeEntry',propertyName:'datetimeEntry',_appendClass:'datetimeEntry_append',_controlClass:'datetimeEntry_control',_expandClass:'datetimeEntry_expand',setDefaults:function(a){$.extend(this._defaults,a||{});return this},_attachPlugin:function(b,c){var d=$(b);if(d.hasClass(this.markerClassName)){return}var e={options:$.extend({},this._defaults,c),input:d,_field:0,_selectedYear:0,_selectedMonth:0,_selectedDay:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0};this._decodeDatetimeFormat(e);d.data(this.propertyName,e).addClass(this.markerClassName).bind('focus.'+this.propertyName,this._doFocus).bind('blur.'+this.propertyName,this._doBlur).bind('click.'+this.propertyName,this._doClick).bind('keydown.'+this.propertyName,this._doKeyDown).bind('keypress.'+this.propertyName,this._doKeyPress).bind('paste.'+this.propertyName,function(a){setTimeout(function(){v._extractDatetime(e)},1)});this._optionPlugin(b,c)},_optionPlugin:function(a,b,c){a=$(a);var d=a.data(this.propertyName);if(!b||(typeof b=='string'&&c==null)){var e=b;b=(d||{}).options;return(b&&e?b[e]:b)}if(!a.hasClass(this.markerClassName)){return}b=b||{};if(typeof b=='string'){var e=b;b={};b[e]=c}var f=this._parseDatetime(d,a.val());$.extend(d.options,b);d._field=0;this._decodeDatetimeFormat(d);if(f){this._setDatetime(d,f)}a.next('span.'+this._appendClass).remove();a.parent().find('span.'+this._controlClass).remove();if($.fn.mousewheel){a.unmousewheel()}var g=(!d.options.spinnerImage?null:$('<span class="'+this._controlClass+'" style="display: inline-block; '+'background: url(\''+d.options.spinnerImage+'\') 0 0 no-repeat; width: '+d.options.spinnerSize[0]+'px; height: '+d.options.spinnerSize[1]+'px;"></span>'));a.after(d.options.appendText?'<span class="'+this._appendClass+'">'+d.options.appendText+'</span>':'').after(g||'');if(d.options.useMouseWheel&&$.fn.mousewheel){a.mousewheel(this._doMouseWheel)}if(g){g.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)}},_enablePlugin:function(a){this._enableDisable(a,false)},_disablePlugin:function(a){this._enableDisable(a,true)},_enableDisable:function(b,c){var d=$.data(b,this.propertyName);if(!d){return}b.disabled=c;if(b.nextSibling&&b.nextSibling.nodeName.toLowerCase()=='span'){v._changeSpinner(d,b.nextSibling,(c?5:-1))}v._disabledInputs=$.map(v._disabledInputs,function(a){return(a==b?null:a)});if(c){v._disabledInputs.push(b)}},_isDisabledPlugin:function(a){return $.inArray(a,this._disabledInputs)>-1},_decodeDatetimeFormat:function(a){a._fields=[];a._ampmField=-1;for(var i=0;i<a.options.datetimeFormat.length;i++){if(a.options.datetimeFormat.charAt(i).match(/[yYoOnNdDwWhHmMsSa]/)){a._fields.push(i)}if(a.options.datetimeFormat.charAt(i)=='a'){a._ampmField=a._fields.length-1}}},_destroyPlugin:function(b){b=$(b);if(!b.hasClass(this.markerClassName)){return}b.removeClass(this.markerClassName).removeData(this.propertyName).unbind('.'+this.propertyName);if($.fn.mousewheel){b.unmousewheel()}this._disabledInputs=$.map(this._disabledInputs,function(a){return(a==b[0]?null:a)});b.siblings('.'+this._appendClass+',.'+this._controlClass).remove()},_setDatetimePlugin:function(a,b){var c=$.data(a,this.propertyName);if(c){if(b===null||b===''){c.input.val('')}else{this._setDatetime(c,b?(typeof b=='object'?new Date(b.getTime()):b):null)}}},_getDatetimePlugin:function(a){var b=$.data(a,this.propertyName);return(b?this._parseDatetime(b,b.input.val()):null)},_getOffsetPlugin:function(a){var b=$.data(a,this.propertyName);var c=(b?v._parseDatetime(b,b.input.val()):null);return(!c?0:(c.getHours()*3600+c.getMinutes()*60+c.getSeconds())*1000)},_doFocus:function(a){var b=(a.nodeName&&a.nodeName.toLowerCase()=='input'?a:this);if(v._lastInput==b||v._isDisabledPlugin(b)){v._focussed=false;return}var c=$.data(b,v.propertyName);v._focussed=true;v._lastInput=b;v._blurredInput=null;$.extend(c.options,($.isFunction(c.options.beforeShow)?c.options.beforeShow.apply(b,[b]):{}));v._extractDatetime(c);setTimeout(function(){v._showField(c)},10)},_doBlur:function(a){v._blurredInput=v._lastInput;v._lastInput=null},_doClick:function(b){var c=b.target;var d=$.data(c,v.propertyName);if(!v._focussed){var e=d.options.datetimeFormat;d._field=0;if(c.selectionStart!=null){var f=0;for(var g=0;g<e.length;g++){f+=v._fieldLength(d,e.charAt(g));if(c.selectionStart<f){break}d._field+=(e.charAt(g).match(/[yondwhmsa]/i)?1:0)}}else if(c.createTextRange){var h=$(b.srcElement);var i=c.createTextRange();var j=function(a){return{thin:2,medium:4,thick:6}[a]||a};var k=b.clientX+document.documentElement.scrollLeft-(h.offset().left+parseInt(j(h.css('border-left-width')),10))-i.offsetLeft;var f=0;for(var g=0;g<e.length;g++){f+=v._fieldLength(d,e.charAt(g));i.collapse();i.moveEnd('character',f);if(k<i.boundingWidth){break}d._field+=(e.charAt(g).match(/[yondwhmsa]/i)?1:0)}}}v._showField(d);v._focussed=false},_doKeyDown:function(a){if(a.keyCode>=48){return true}var b=$.data(a.target,v.propertyName);switch(a.keyCode){case 9:return(a.shiftKey?v._changeField(b,-1,true):v._changeField(b,+1,true));case 35:if(a.ctrlKey){v._setValue(b,'')}else{b._field=b._fields.length-1;v._adjustField(b,0)}break;case 36:if(a.ctrlKey){v._setDatetime(b)}else{b._field=0;v._adjustField(b,0)}break;case 37:v._changeField(b,-1,false);break;case 38:v._adjustField(b,+1);break;case 39:v._changeField(b,+1,false);break;case 40:v._adjustField(b,-1);break;case 46:v._setValue(b,'');break;default:return true}return false},_doKeyPress:function(a){var b=String.fromCharCode(a.charCode==undefined?a.keyCode:a.charCode);if(b<' '){return true}var c=$.data(a.target,v.propertyName);v._handleKeyPress(c,b);return false},_doMouseWheel:function(a,b){if(v._isDisabledPlugin(a.target)){return}var c=$.data(a.target,v.propertyName);c.input.focus();if(!c.input.val()){v._extractDatetime(c)}v._adjustField(c,b);a.preventDefault()},_expandSpinner:function(b){var c=v._getSpinnerTarget(b);var d=$.data(v._getInput(c),v.propertyName);if(v._isDisabledPlugin(d.input[0])){return}if(d.options.spinnerBigImage){d._expanded=true;var e=$(c).offset();var f=null;$(c).parents().each(function(){var a=$(this);if(a.css('position')=='relative'||a.css('position')=='absolute'){f=a.offset()}return!f});$('<div class="'+v._expandClass+'" style="position: absolute; left: '+(e.left-(d.options.spinnerBigSize[0]-d.options.spinnerSize[0])/2-(f?f.left:0))+'px; top: '+(e.top-(d.options.spinnerBigSize[1]-d.options.spinnerSize[1])/2-(f?f.top:0))+'px; width: '+d.options.spinnerBigSize[0]+'px; height: '+d.options.spinnerBigSize[1]+'px; background: transparent url('+d.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(v._handleSpinner).mouseup(v._endSpinner).mouseout(v._endExpand).mousemove(v._describeSpinner).insertAfter(c)}},_getInput:function(a){return $(a).siblings('.'+v.markerClassName)[0]},_describeSpinner:function(a){var b=v._getSpinnerTarget(a);var c=$.data(v._getInput(b),v.propertyName);b.title=c.options.spinnerTexts[v._getSpinnerRegion(c,a)]},_handleSpinner:function(a){var b=v._getSpinnerTarget(a);var c=v._getInput(b);if(v._isDisabledPlugin(c)){return}if(c==v._blurredInput){v._lastInput=c;v._blurredInput=null}var d=$.data(c,v.propertyName);v._doFocus(c);var e=v._getSpinnerRegion(d,a);v._changeSpinner(d,b,e);v._actionSpinner(d,e);v._timer=null;v._handlingSpinner=true;if(e>=3&&d.options.spinnerRepeat[0]){v._timer=setTimeout(function(){v._repeatSpinner(d,e)},d.options.spinnerRepeat[0]);$(b).one('mouseout',v._releaseSpinner).one('mouseup',v._releaseSpinner)}},_actionSpinner:function(a,b){if(!a.input.val()){v._extractDatetime(a)}switch(b){case 0:this._setDatetime(a);break;case 1:this._changeField(a,-1,false);break;case 2:this._changeField(a,+1,false);break;case 3:this._adjustField(a,+1);break;case 4:this._adjustField(a,-1);break}},_repeatSpinner:function(a,b){if(!v._timer){return}v._lastInput=v._blurredInput;this._actionSpinner(a,b);this._timer=setTimeout(function(){v._repeatSpinner(a,b)},a.options.spinnerRepeat[1])},_releaseSpinner:function(a){clearTimeout(v._timer);v._timer=null},_endExpand:function(a){v._timer=null;var b=v._getSpinnerTarget(a);var c=v._getInput(b);var d=$.data(c,v.propertyName);$(b).remove();d._expanded=false},_endSpinner:function(a){v._timer=null;var b=v._getSpinnerTarget(a);var c=v._getInput(b);var d=$.data(c,v.propertyName);if(!v._isDisabledPlugin(c)){v._changeSpinner(d,b,-1)}if(v._handlingSpinner){v._lastInput=v._blurredInput}if(v._lastInput&&v._handlingSpinner){v._showField(d)}v._handlingSpinner=false},_getSpinnerTarget:function(a){return a.target||a.srcElement},_getSpinnerRegion:function(a,b){var c=this._getSpinnerTarget(b);var d=$(c).offset();var e=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop];var f=(a.options.spinnerIncDecOnly?99:b.clientX+e[0]-d.left);var g=b.clientY+e[1]-d.top;var h=a.options[a._expanded?'spinnerBigSize':'spinnerSize'];var i=(a.options.spinnerIncDecOnly?99:h[0]-1-f);var j=h[1]-1-g;if(h[2]>0&&Math.abs(f-i)<=h[2]&&Math.abs(g-j)<=h[2]){return 0}var k=Math.min(f,g,i,j);return(k==f?1:(k==i?2:(k==g?3:4)))},_changeSpinner:function(a,b,c){$(b).css('background-position','-'+((c+1)*a.options[a._expanded?'spinnerBigSize':'spinnerSize'][0])+'px 0px')},_extractDatetime:function(a){var b=this._parseDatetime(a,a.input.val())||this._normaliseDatetime(this._determineDatetime(a,a.options.defaultDatetime)||new Date());var c=this._constrainTime(a,[b.getHours(),b.getMinutes(),b.getSeconds()]);a._selectedYear=b.getFullYear();a._selectedMonth=b.getMonth();a._selectedDay=b.getDate();a._selectedHour=c[0];a._selectedMinute=c[1];a._selectedSecond=c[2];a._lastChr='';a._field=Math.max(0,a.options.initialField);if(a.input.val()!=''){this._showDatetime(a)}},_parseDatetime:function(a,b){if(!b){return null}var c=0;var d=0;var e=0;var f=0;var g=0;var h=0;var k=0;var l=a.options.datetimeFormat;var m=function(){while(k<b.length&&b.charAt(k).match(/^[0-9]/)){k++}};var i;for(i=0;i<l.length&&k<b.length;i++){var n=l.charAt(i);var o=parseInt(b.substring(k),10);if(n.match(/y|o|d|h|m|s/i)&&isNaN(o)){throw'Invalid date';}o=(isNaN(o)?0:o);switch(n){case'y':case'Y':c=o;m();break;case'o':case'O':d=o;m();break;case'n':case'N':var p=a.options[n=='N'?'monthNames':'monthNamesShort'];for(var j=0;j<p.length;j++){if(b.substring(k).substr(0,p[j].length).toLowerCase()==p[j].toLowerCase()){d=j+1;k+=p[j].length;break}}break;case'w':case'W':var q=a.options[n=='W'?'dayNames':'dayNamesShort'];for(var j=0;j<q.length;j++){if(b.substring(k).substr(0,q[j].length).toLowerCase()==q[j].toLowerCase()){k+=q[j].length+1;break}}o=parseInt(b.substring(k),10);o=(isNaN(o)?0:o);case'd':case'D':e=o;m();break;case'h':case'H':f=o;m();break;case'm':case'M':g=o;m();break;case's':case'S':h=o;m();break;case'a':var r=(b.substr(k,a.options.ampmNames[1].length).toLowerCase()==a.options.ampmNames[1].toLowerCase());f=(f==12?0:f)+(r?12:0);k+=a.options.ampmNames[0].length;break;default:k++}}if(i<l.length){throw'Invalid date';}c+=(c>=100||l.indexOf('y')==-1?0:(c>this._shortYearCutoff(a)?1900:2000));var s=this._constrainTime(a,[f,g,h]);var t=new Date(c,Math.max(0,d-1),e,s[0],s[1],s[2]);if(l.match(/y|o|n|d|w/i)&&(t.getFullYear()!=c||t.getMonth()+1!=d||t.getDate()!=e)){throw'Invalid date';}return t},_showDatetime:function(a){this._setValue(a,this._formatDatetime(a,a.options.datetimeFormat));this._showField(a)},_formatDatetime:function(a,b){var c='';var d=b.indexOf('a')>-1;for(var i=0;i<b.length;i++){var e=b.charAt(i);switch(e){case'y':c+=this._formatNumber(a._selectedYear%100);break;case'Y':c+=this._formatNumber(a._selectedYear,4);break;case'o':case'O':c+=this._formatNumber(a._selectedMonth+1,e=='o'?1:2);break;case'n':case'N':c+=a.options[e=='N'?'monthNames':'monthNamesShort'][a._selectedMonth];break;case'd':case'D':c+=this._formatNumber(a._selectedDay,e=='d'?1:2);break;case'w':case'W':c+=a.options[e=='W'?'dayNames':'dayNamesShort'][new Date(a._selectedYear,a._selectedMonth,a._selectedDay).getDay()]+' '+this._formatNumber(a._selectedDay);break;case'h':case'H':c+=this._formatNumber(!d?a._selectedHour:a._selectedHour%12||12,e=='h'?1:2);break;case'm':case'M':c+=this._formatNumber(a._selectedMinute,e=='m'?1:2);break;case's':case'S':c+=this._formatNumber(a._selectedSecond,e=='s'?1:2);break;case'a':c+=a.options.ampmNames[a._selectedHour<12?0:1];break;default:c+=e;break}}return c},_showField:function(a){var b=a.input[0];if(a.input.is(':hidden')||v._lastInput!=b){return}var c=0;for(var i=0;i<a._fields[a._field];i++){c+=this._fieldLength(a,a.options.datetimeFormat.charAt(i))}var d=c+this._fieldLength(a,a.options.datetimeFormat.charAt(i));if(b.setSelectionRange){b.setSelectionRange(c,d)}else if(b.createTextRange){var e=b.createTextRange();e.moveStart('character',c);e.moveEnd('character',d-a.input.val().length);e.select()}if(!b.disabled){b.focus()}},_fieldLength:function(a,b){switch(b){case'Y':return 4;case'n':case'N':return a.options[b=='N'?'monthNames':'monthNamesShort'][a._selectedMonth].length;case'w':case'W':return a.options[b=='W'?'dayNames':'dayNamesShort'][new Date(a._selectedYear,a._selectedMonth,a._selectedDay).getDay()].length+3;case'y':case'O':case'D':case'H':case'M':case'S':return 2;case'o':return(''+(a._selectedMonth+1)).length;case'd':return(''+a._selectedDay).length;case'h':return(''+(a._ampmField==-1?a._selectedHour:a._selectedHour%12||12)).length;case'm':return(''+a._selectedMinute).length;case's':return(''+a._selectedSecond).length;case'a':return a.options.ampmNames[0].length;default:return 1}},_formatNumber:function(a,b){a=''+a;b=b||2;while(a.length<b){a='0'+a}return a},_setValue:function(a,b){if(b!=a.input.val()){if(a.options.altField){$(a.options.altField).val(!b?'':this._formatDatetime(a,a.options.altFormat||a.options.datetimeFormat))}a.input.val(b).trigger('change')}},_changeField:function(a,b,c){var d=(a.input.val()==''||a._field==(b==-1?0:a._fields.length-1));if(!d){a._field+=b}this._showField(a);a._lastChr='';return(d&&c)},_adjustField:function(a,b){if(a.input.val()==''){b=0}var c=a.options.datetimeFormat.charAt(a._fields[a._field]);var d=a._selectedYear+(c.match(/y/i)?b:0);var e=a._selectedMonth+(c.match(/o|n/i)?b:0);var f=(c.match(/d|w/i)?a._selectedDay+b:Math.min(a._selectedDay,this._getDaysInMonth(d,e)));var g=a.options.timeSteps;var h=a._selectedHour+(c.match(/h/i)?b*g[0]:0)+(c=='a'&&b!=0?(a._selectedHour<12?+12:-12):0);var i=a._selectedMinute+(c.match(/m/i)?b*g[1]:0);var j=a._selectedSecond+(c.match(/s/i)?b*g[2]:0);this._setDatetime(a,new Date(d,e,f,h,i,j))},_getDaysInMonth:function(a,b){return new Date(a,b+1,0,12).getDate()},_setDatetime:function(a,b){b=this._normaliseDatetime(this._determineDatetime(a,b||a.options.defaultDatetime)||new Date());var c=this._constrainTime(a,[b.getHours(),b.getMinutes(),b.getSeconds()]);b.setHours(c[0],c[1],c[2]);var d=this._normaliseDatetime(this._determineDatetime(a,a.options.minDatetime));var e=this._normaliseDatetime(this._determineDatetime(a,a.options.maxDatetime));var f=this._normaliseDatetime(this._determineDatetime(a,a.options.minTime),'d');var g=this._normaliseDatetime(this._determineDatetime(a,a.options.maxTime),'d');b=(d&&b<d?d:(e&&b>e?e:b));if(f&&this._normaliseDatetime(new Date(b.getTime()),'d')<f){this._copyTime(f,b)}if(g&&this._normaliseDatetime(new Date(b.getTime()),'d')>g){this._copyTime(g,b)}a._selectedYear=b.getFullYear();a._selectedMonth=b.getMonth();a._selectedDay=b.getDate();a._selectedHour=b.getHours();a._selectedMinute=b.getMinutes();a._selectedSecond=b.getSeconds();this._showDatetime(a)},_copyDate:function(a,b){b.setFullYear(a.getFullYear());b.setMonth(a.getMonth());b.setDate(a.getDate())},_copyTime:function(a,b){b.setHours(a.getHours());b.setMinutes(a.getMinutes());b.setSeconds(a.getSeconds())},_determineDatetime:function(l,m){var n=function(a){var b=new Date();b.setSeconds(b.getSeconds()+a);return b};var o=function(a){var b;try{b=v._parseDatetime(l,a);if(b){return b}}catch(e){}a=a.toLowerCase();b=new Date();var c=b.getFullYear();var d=b.getMonth();var f=b.getDate();var g=b.getHours();var h=b.getMinutes();var i=b.getSeconds();var j=/([+-]?[0-9]+)\s*(s|m|h|d|w|o|y)?/g;var k=j.exec(a);while(k){switch(k[2]||'s'){case's':i+=parseInt(k[1],10);break;case'm':h+=parseInt(k[1],10);break;case'h':g+=parseInt(k[1],10);break;case'd':f+=parseInt(k[1],10);break;case'w':f+=parseInt(k[1],10)*7;break;case'o':d+=parseInt(k[1],10);break;case'y':c+=parseInt(k[1],10);break}k=j.exec(a)}return new Date(c,d,f,g,h,i)};return(m?(typeof m=='string'?o(m):(typeof m=='number'?n(m):m)):null)},_normaliseDatetime:function(a,b){if(!a){return null}if(b=='d'){a.setFullYear(0);a.setMonth(0);a.setDate(0)}if(b=='t'){a.setHours(12);a.setMinutes(0);a.setSeconds(0)}a.setMilliseconds(0);return a},_handleKeyPress:function(a,b){b=b.toLowerCase();var c=a.options.datetimeFormat.charAt(a._fields[a._field]);var d=a.options.datetimeFormat.charAt(a._fields[a._field]+1);d=('yYoOnNdDwWhHmMsSa'.indexOf(d)==-1?d:'');if((a.options.datetimeSeparators+d).indexOf(b)>-1){this._changeField(a,+1,false)}else if(b>='0'&&b<='9'){var e=parseInt(b,10);var f=parseInt(a._lastChr+b,10);var g=(!c.match(/y/i)?a._selectedYear:f);var h=(!c.match(/o|n/i)?a._selectedMonth+1:(f>=1&&f<=12?f:(e>0?e:a._selectedMonth+1)));var j=(!c.match(/d|w/i)?a._selectedDay:(f>=1&&f<=this._getDaysInMonth(g,h-1)?f:(e>0?e:a._selectedDay)));var k=(!c.match(/h/i)?a._selectedHour:(a._ampmField==-1?(f<24?f:e):(f>=1&&f<=12?f:(e>0?e:a._selectedHour))%12+(a._selectedHour>=12?12:0)));var l=(!c.match(/m/i)?a._selectedMinute:(f<60?f:e));var m=(!c.match(/s/i)?a._selectedSecond:(f<60?f:e));var n=this._constrainTime(a,[k,l,m]);var o=this._shortYearCutoff(a);this._setDatetime(a,new Date(g+(g>=100||c!='y'?0:(g>o?1900:2000)),h-1,j,n[0],n[1],n[2]));a._lastChr=(c!='Y'?'':a._lastChr.substr(Math.max(0,a._lastChr.length-2)))+b}else if(c.match(/n/i)){a._lastChr+=b;var p=a.options[c=='n'?'monthNamesShort':'monthNames'];var q=function(){for(var i=0;i<p.length;i++){if(p[i].toLowerCase().substring(0,a._lastChr.length)==a._lastChr){return i;break}}return-1};var h=q();if(h==-1){a._lastChr=b;h=q()}if(h==-1){a._lastChr=''}else{var g=a._selectedYear;var j=Math.min(a._selectedDay,this._getDaysInMonth(g,h));this._setDatetime(a,this._normaliseDatetime(new Date(g,h,j,a._selectedHour,a._selectedMinute,a._selectedSecond)))}}else if(a._ampmField>-1){if((b==a.options.ampmNames[0].substring(0,1).toLowerCase()&&a._selectedHour>=12)||(b==a.options.ampmNames[1].substring(0,1).toLowerCase()&&a._selectedHour<12)){var r=a._field;a._field=a._ampmField;this._adjustField(a,+1);a._field=r;this._showField(a)}}},_shortYearCutoff:function(a){var b=a.options.shortYearCutoff;if(typeof b=='string'){b=new Date().getFullYear()+parseInt(b,10)}return b%100},_constrainTime:function(a,b){var c=(b!=null);if(!c){var d=this._determineTime(a,a.options.defaultTime)||new Date();b=[d.getHours(),d.getMinutes(),d.getSeconds()]}var e=false;var f=a.options.timeSteps;for(var i=0;i<f.length;i++){if(e){b[i]=0}else if(f[i]>1){b[i]=Math.round(b[i]/f[i])*f[i];e=true}}return b}});var u=['getDatetime','getOffset','isDisabled'];function isNotChained(a,b){if(a=='option'&&(b.length==0||(b.length==1&&typeof b[0]=='string'))){return true}return $.inArray(a,u)>-1}$.fn.datetimeEntry=function(b){var c=Array.prototype.slice.call(arguments,1);if(isNotChained(b,c)){return v['_'+b+'Plugin'].apply(v,[this[0]].concat(c))}return this.each(function(){if(typeof b=='string'){if(!v['_'+b+'Plugin']){throw'Unknown command: '+b;}v['_'+b+'Plugin'].apply(v,[this].concat(c))}else{var a=($.fn.metadata?$(this).metadata():{});v._attachPlugin(this,$.extend({},a,b||{}))}})};var v=$.datetimeEntry=new DatetimeEntry()})(jQuery);